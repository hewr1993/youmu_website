<!DOCTYPE html>
<html class="no-js" lang="en" ng-app="youmuApp">
    <head lang="en">
        <title>视频点播页</title>
        {% include 'partials/head.html' %}
        <link href="/static/video-js/video-js.css" rel="stylesheet">
        <script src="/static/video-js/video.js"></script>
        <script src="/static/js/CommentCoreLibrary/CommentCoreLibrary.js"></script>
        <script src="/static/js/CommentCoreLibrary/BilibiliFormat.js"></script>
        <link href="/static/css/videojs_ABdm.css" rel="stylesheet">
        <script src="/static/js/videojs_ABdm.js"></script>
        <script src="/static/js/vendor/jquery.js"></script>
        <link href="/static/fonts/foundation-icons.css" rel="stylesheet">
		<script>
			$(document).ready(function(){
				window.thevideojs = videojs("playbox");
				thevideojs.ABP();
				thevideojs.danmu.load("/static/comment.xml");
			});
		</script>
    </head>
    <body class="video" ng-controller="videoDataCtrl">
        <div class="main">
            {% include 'partials/topbar.html' %}
            <div class="video-main-container">
                <div class="video-player-container">
                    <input type="hidden" value="{{ video_id }}" id="video_id"/>
                    <video id="playbox" class="video-js vjs-default-skin" controls preload="auto" poster="{{video.cover}}" data-setup='{}' width="100%">
                        <source src="" id="playboxUrl" type="video/mp4" />
                        <p class="vjs-no-js">
                            To view this video please enable JavaScript, and consider upgrading to a web browser
                            that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
                        </p>
                    </video>
                    <script>
                        $("#playboxUrl").attr("src", "http://" + document.domain + ":8888/" + $("#video_id").val());
                    </script>
                </div>

                <div class="video-info">
                    <div class="video-meta">
                        <div class="video-header">
                            <div class="video-avatar">
                                <img class="avatar" ng-src="{{video.owner_avatar}}" />
                            </div>
                            <div class="byline">
                                <h1 class="title">{{video.title}}</h1>
                                <div class="username">{{video.owner_name}}</div>
                                <div class="time">{{video.upload_time | date}}</div>
                            </div>
                        </div>
                        <div class="description">{{video.description}}</div>
                    </div>

                    <div class="video-stats">
                        <div class="video-stat views-count">
                            <span class="label">观看</span>
                            <span class="data">{{video.play_count}}</span>
                        </div>
                        <a class="video-stat likes-count" ng-class="{true: 'has-liked', false: 'has-not-liked'}[melike]" ng-click="likeVideo()">
                            <span class="label">点赞</span>
                            <span class="data">{{video.like}}</span>
                        </a>
                        <a class="video-stat comments-count" href="#comments">
                            <span class="label">评论</span>
                            <span class="data">{{video.comments_count}}</span>
                        </a>
                    </div>
                </div>

            </div>
        </div>

        <div class="content">
            <div class="main comments-container">
                <a name="comments" />
                <h2 class="main-subheader">评论</h2>
                <ul class="comments-list">
                    <li class="comment-item" ng-repeat="comment in comments | orderBy: 'floor'">
                        <div class="comment-header">
                            <div class="comment-avatar"><img class="avatar" ng-src="{{comment.user_avatar}}" /></div>
                            <div class="byline">
                                <div class="username">{{comment.user_name}}</div>
                                <div class="time">{{comment.reply_time}}</div>
                                <a class="comment-floor-num" name="comment-{{comment.floor}}" href="#comment-{{comment.floor}}">{{comment.floor}}</a>
                            </div>
                            <a class="comment-del-button" ng-show="comment.user_id == user_id || isAdmin" ng-click="delComment(comment.comment_id)">删除评论</a>
                        </div>
                        <div class="comment-content">{{comment.content}}</div>
                    </li>
                </ul>

                <form class="comment-form custom" id="commentForm" data-abide="ajax">
                    <textarea id="commentContent" placeholder="请输入你的评论..." required></textarea>
                    <small class="error">评论不能为空</small>
                    <button type="submit" id="commentButton">吐槽</button>
                </form>

            </div>
        </div>

    </body>
    {% include 'partials/foot.html' %}
</html>
