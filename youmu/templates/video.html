<!DOCTYPE html>
<html class="no-js" lang="en" ng-app="youmuApp">
    <head lang="en">
        <title>视频点播页</title>
        {% include 'partials/head.html' %}
        <link href="/static/video-js/video-js.css" rel="stylesheet">
        <script src="/static/video-js/video.js"></script>
        <script src="/static/js/CommentCoreLibrary/CommentCoreLibrary.js"></script>
        <script src="/static/js/CommentCoreLibrary/BilibiliFormat.js"></script>
        <link href="/static/css/videojs_ABdm.css" rel="stylesheet">
        <script src="/static/js/videojs_ABdm.js"></script>
        <script src="/static/js/vendor/jquery.js"></script>
        <link href="/static/fonts/foundation-icons.css" rel="stylesheet">
		<script>
			$(document).ready(function(){
				window.thevideojs = videojs("playbox");
				thevideojs.ABP();
				thevideojs.danmu.load("/static/comment.xml");
			});
		</script>
    </head>
    <body class="video" ng-controller="videoDataCtrl">
        <div class="main">
            {% include 'partials/topbar.html' %}
            <div class="video-main-container">
                <div class="video-player-container">
                    <input type="hidden" value="{{ video_id }}" id="video_id"/>
                    <video id="playbox" class="video-js vjs-default-skin" controls preload="auto" poster="{{video.cover}}" data-setup='{}' width="100%">
                        <source src="" id="playboxUrl" type="video/mp4" />
                        <p class="vjs-no-js">
                            To view this video please enable JavaScript, and consider upgrading to a web browser
                            that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
                        </p>
                    </video>
                    <script>
                        $("#playboxUrl").attr("src", "http://" + document.domain + ":8888/" + $("#video_id").val());
                    </script>
                </div>

                <div class="video-info">
                    <div class="video-meta">
                        <div class="video-header">
                            <div class="video-avatar">
                                <img class="avatar" src="/static/img/placeholder200x200.jpeg" />
                            </div>
                            <div class="video-byline">
                                <h1 class="video-title">{{video.title}}</h1>
                                <div class="video-owner-name">{{video.owner_name}}</div>
                                <div class="video-upload-time">{{video.upload_time | date}}</div>
                            </div>
                        </div>
                        <div class="video-description">{{video.description}}</div>
                    </div>

                    <div class="video-stats">
                        <div class="views-count">
                            <span class="label">观看</span>
                            <span class="data">{{video.play_count}}</span>
                        </div>
                        <a class="likes-count" ng-click="likeVideo()">
                            <span class="label">点赞</span>
                            <span class="data">{{video.like}}</span>
                            <span class="data" ng-show="melike">（您赞过了）</span>
                        </a>
                    </div>
                </div>

            </div>
        </div>

        <div class="content">
            <div class="main comments-container">
                <h2>评论</h2>
                <ul class="comments-list" ng-repeat="comment in comments | orderBy: 'floor'">
                    <li class="comment-item">
                        <div class="comment-user-avatar"><img src="/static/img/placeholder200x200.jpeg" /></div>
                        <i class="fi-x" 
                            ng-show="comment.user_id == user_id || isAdmin" 
                            ng-click="delComment(comment.comment_id)"
                            style="cursor:pointer;">
                        </i>
                        <div class="comment-user-name">{{comment.user_name}}</div>
                        <div class="comment-content">{{comment.content}}</div>
                        <div class="time">{{comment.reply_time}}</div>
                        <div class="comment-floor-num">{{comment.floor}}</div>
                    </li>
                </ul>

                <form class="comment-form custom" id="commentForm" data-abide="ajax">
                    <fieldset>
                        <legend>不吐不快</legend>
                        <input type="text" id="commentContent" placeholder="请输入你的评论..." required />
                        <small class="error">评论不能为空</small> 
                        <button type="submit" id="commentButton">吐槽</button>
                    </fieldset>
                </form>

            </div>
        </div>

    </body>
    {% include 'partials/foot.html' %}
</html>
